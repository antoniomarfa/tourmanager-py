{% extends "base.html" %}

{% block title %}Pasarrelas de Pago{% endblock %}

{% block content %}

<nav class="breadcrumb-container" aria-label="breadcrumb">
  <ol class="breadcrumb mb-0">
    <li class="breadcrumb-item">
      <a href="/{{ empresa }}/manager/index">
        <i class="bi bi-house-door-fill me-1"></i> Home
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">
      <i class="bi bi-pencil-square me-1"></i> Pasarelas de Pago
    </li>
  </ol>
</nav>

<style>
  .payment-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    background-color: #fff;
  }
  .payment-logo {
    width: 100px;
    height: auto;
  }
  .integrated-icon {
    color: green;
    font-size: 1.4rem;
    margin-left: 10px;
  }
  .integration-actions {
    display: flex;
    align-items: center;
    gap: 10px; 
  }
</style>

<div class="bg-light py-5">
  <div class="container">
    <h2 class="mb-4 text-center">Integraciones de Pasarelas de Pago</h2>
    <hr><br><br>

   {% for gatewayc in gatewaysc %}

      {% if gatewayc.existe=='S' %}
        <div class="payment-card row align-items-center" style="background-color:#f2f2f2;">
      {% else %}
        <div class="payment-card row align-items-center">
      {% endif %}

        <div class="col-md-2 text-center">
          <img src="http://localhost:8000/static/{{ gatewayc.gateway_image }}" class="payment-logo" alt="Gateway Logo">
        </div>
        <div class="col-md-7">
          {% if gatewayc.existe=='S' %}
            <h4 class="mb-1 integrated-icon">Esta integrado con : {{gatewayc.gateway_type }}</h4>
          {% else %}
            <h4 class="mb-1">Integrarse con : {{ gatewayc.gateway_type }}</h4>
          {% endif %}
          <p class="mb-1">{{ gatewayc.gateway_description }}</p>
        </div>
        <div class="col-md-3 integration-actions">
          {% if gatewayc.existe =='S' %}
            <a href="#" class="btn btn-primary btn-sm" title="Elimiar" data-original-title="Quitar" data-id="{{ gatewayc.id }}">Quitar Integracion</a>

          {% else %}
            <button 
              type="button" 
              class="btn btn-success btn-sm" 
              data-bs-toggle="modal" 
              data-bs-target="#Modaldato"
              data-gateway-id="{{ gatewayc.id }}"
              data-gateway-type="{{ gatewayc.gateway_type }}">
              Integrar
            </button>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Modal Bootstrap 5 -->
<div class="modal fade" id="Modaldato"> 
  <div class="modal-dialog">
    <div class="modal-content">
      <form role="form" id="form" method="post" action="/{{ empresa }}/manager/gateways/create" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="ModaldatoLabel">Modal title</h5>
          <button type="button" class="btn" data-bs-dismiss="modal" aria-label="Cerrar">
            <i class="fas fa-times"></i> <!-- si usas FontAwesome -->
          </button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="gateway_id" id="gateway_id" />

          <!-- Panel: Flow -->
          <div class="card mb-3 shadow-sm border-0 d-none panel-flow">
            <div class="card-header bg-primary text-white py-2">
              <i class="bi bi-lightning-charge me-1"></i> Configuración de Flow
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="apikey" class="form-label">API Key</label>
                  <input type="text" class="form-control" name="apikey" id="apikey" placeholder="Ingresa tu API Key" />
                  <small class="form-text text-muted">
                    Clave proporcionada por Flow para autenticar las solicitudes a su API.
                  </small>
                </div>
                <div class="col-md-6">
                  <label for="secretkey" class="form-label">Secret Key</label>
                  <input type="text" class="form-control" name="secretkey" id="secretkey" placeholder="Ingresa tu Secret Key" />
                  <small class="form-text text-muted">
                    Llave secreta asociada a tu cuenta de Flow. No la compartas públicamente.
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel: Transbank -->
          <div class="card mb-3 shadow-sm border-0 d-none panel-trbk">
            <div class="card-header bg-danger text-white py-2">
              <i class="bi bi-credit-card-2-front me-1"></i> Configuración de Transbank
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="comercialcode" class="form-label">Código de Comercio</label>
                  <input type="text" class="form-control" name="comercialcode" id="comercialcode" placeholder="Ej: 597020000540" />
                  <small class="form-text text-muted">
                    Código único que identifica tu comercio ante Transbank.
                  </small>
                </div>
                <div class="col-md-6">
                  <label for="keysecret" class="form-label">Secret Key</label>
                  <input type="text" class="form-control" name="keysecret" id="keysecret" placeholder="Ingresa tu llave secreta" />
                  <small class="form-text text-muted">
                    Llave privada generada por Transbank para firmar transacciones.
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel: Mercado Pago -->
          <div class="card mb-3 shadow-sm border-0 d-none panel-mp">
            <div class="card-header bg-info text-white py-2">
              <i class="bi bi-wallet2 me-1"></i> Configuración de Mercado Pago
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="usersid" class="form-label">ID Usuario</label>
                  <input type="text" class="form-control" name="usersid" id="usersid" placeholder="Ingresa tu ID de usuario" />
                  <small class="form-text text-muted">
                    Identificador de usuario asignado por Mercado Pago.
                  </small>
                </div>
                <div class="col-md-6">
                  <label for="publickey" class="form-label">Public Key</label>
                  <input type="text" class="form-control" name="publickey" id="publickey" placeholder="Ingresa tu Public Key" />
                  <small class="form-text text-muted">
                    Clave pública utilizada para inicializar el checkout o SDK de Mercado Pago.
                  </small>
                </div>
                <div class="col-md-6">
                  <label for="accesstoken" class="form-label">Access Token</label>
                  <input type="text" class="form-control" name="accesstoken" id="accesstoken" placeholder="Ingresa tu Access Token" />
                  <small class="form-text text-muted">
                    Token de acceso privado usado para realizar operaciones seguras en la API.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Continuar</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/gateways/index.js"></script>
{% endblock %}