{% extends "base.html" %}

{% block title %}Lista de Usuarios{% endblock %}

{% block content %}


<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/{{ empresa }}/manager/index">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Usuarios</li>
  </ol>
</nav>

<div class="container mt-5">
  <h2>Lista de Usuarios</h2>
  <hr>
    {% if msg %}
    <!--
    <div class="alert alert-success alert-dismissible show" role="alert">   
    {{ msg }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>
    -->
    <script>
        Swal.fire({
        title: "Usuarios",
        text: "{{ msg }}",
        icon: "success"
      });
    </script>
    {% endif %}

    {% if error %}
    <!--
    <div class="alert alert-danger alert-dismissible show" role="alert">
    {{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>
    -->
    <script>
        Swal.fire({
        title: "Usuarios",
        text: "{{ error }}",
        icon: "danger"
      });
    </script>
    {% endif %}   
  <div class="form-group text-right">
        {% if cant_access["can_insert"] %}
        <a href="/{{ empresa }}/manager/users/create" class="btn btn-success mb-3"><i class="fa fa-file-text" aria-hidden="true"></i> Nuevo</a>
        {% endif %}
  </div>
  <table class="table table-bordered" id="userTable">
    <thead>
      <th>Usuario</th>
      <th>Nombre</th>
      <th>Perfil</th>
      <th>Estado</th>
      <th>Fecha Actualizacion</th>
      <th>Modificador</th>
      <th></th>
    </thead>
    <tbody>
      {% for user in users %}
      {% set class_status = "text-bg-success" if user.active == 1 else "text-bg-secondary" %} 
      {% set text_status = "Activo" if user.active == 1 else "Inactivo" %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.rol.description }}</td>
          <td width="7%" align="center"><a style="cursor: pointer;" class="change-status" id="{{user.id}}"><span class="badge {{ class_status }}">{{text_status}}</span></a></td>
          <td width="15%"> {{ helper.formatear(user.UpdatedDate) }} </td>
          <td width="15%"> {{ user.author }}</td>
          <td width="15%">
            {% if cant_access["can_update"] %}
            <a href="/manager/users/edit/{{ user.id }}" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i></a>
            {% endif %}
            {% if cant_access["can_delete"] %}
            <a href="#" class="btn btn-sm btn-danger delete-register" title="eliminar" data-original-title="Eliminar" data-id="{{ user.id }}"><i class="fa fa-trash"></i></a>
            {% endif %}
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>  
{% endblock %}

{% block scripts %}
<script src="/static/js/users/index.js"></script>
{% endblock %}